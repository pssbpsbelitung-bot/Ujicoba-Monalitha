<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Monitoring Harga</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:Arial,sans-serif;background:#f3f4f6;padding:24px}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:20px;box-shadow:0 6px 16px rgba(0,0,0,.08)}
select{padding:8px 12px;border-radius:8px}
h2{margin-top:0}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #e5e7eb;text-align:left}
th{background:#f9fafb}
.empty{color:#9ca3af;text-align:center;padding:20px}
</style>
</head>

<body>

<div class="card">
  <label>Pilih Bulan:</label>
  <select id="bulanSelect"></select>
</div>

<div class="card">
  <h2>Grafik Perbandingan Harga</h2>
  <canvas id="hargaChart" height="120"></canvas>
</div>

<div class="card">
  <h2>Alasan Perubahan Harga</h2>
  <table>
    <thead>
      <tr>
        <th>Komoditas</th>
        <th>Alasan</th>
      </tr>
    </thead>
    <tbody id="alasanBody"></tbody>
  </table>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYuI4h54ZH8ZvdsNfJWm82mh4s_tbFzSdN6iX2eNbnjKVI0qHmjVtUPGrcAqs8iaA-M7mVeUfBhMdk/pub?output=csv";

let rawData = [];
let chart;

fetch(CSV_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.trim().split("\n").slice(1);
    rawData = rows.map(r => {
      const c = r.split(",");
      return {
        bulan: c[1]?.trim(),
        komoditas: c[2],
        hargaSebelumnya: Number(c[3]) || 0,
        hargaSekarang: Number(c[4]) || 0,
        alasan: c[5] || ""
      };
    });

    const bulanUnik = [...new Set(rawData.map(d => d.bulan))];
    const select = document.getElementById("bulanSelect");
    select.innerHTML = `<option value="">-- Pilih Bulan --</option>`;
    bulanUnik.forEach(b => {
      select.innerHTML += `<option value="${b}">${b}</option>`;
    });

    select.addEventListener("change", () => renderDashboard(select.value));
  });

function renderDashboard(bulan){
  const data = rawData.filter(d => d.bulan === bulan);

  if(!bulan || data.length === 0){
    clearChart();
    document.getElementById("alasanBody").innerHTML =
      `<tr><td colspan="2" class="empty">Tidak ada data</td></tr>`;
    return;
  }

  const labels = data.map(d => d.komoditas);
  const hargaSebelumnya = data.map(d => d.hargaSebelumnya);
  const hargaSekarang = data.map(d => d.hargaSekarang);

  drawChart(labels, hargaSebelumnya, hargaSekarang);

  document.getElementById("alasanBody").innerHTML = data.map(d => `
    <tr>
      <td>${d.komoditas}</td>
      <td>${d.alasan}</td>
    </tr>
  `).join("");
}

function drawChart(labels, sebelumnya, sekarang){
  const ctx = document.getElementById("hargaChart").getContext("2d");
  if(chart) chart.destroy();

  chart = new Chart(ctx,{
    type:"bar",
    data:{
      labels,
      datasets:[
        {label:"Harga Sebelumnya", data: sebelumnya},
        {label:"Harga Sekarang", data: sekarang}
      ]
    },
    options:{
      responsive:true,
      plugins:{legend:{position:"top"}},
      scales:{y:{beginAtZero:true}}
    }
  });
}

function clearChart(){
  if(chart) chart.destroy();
}
</script>

</body>
</html>
